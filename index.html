<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Yard Lumber Ticket Generator</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  max-width: 900px;
  margin: auto;
}

/* Header / Logo */
.header {
  text-align: center;
  margin-bottom: 15px;
}

.header img {
  max-width: 260px;
  height: auto;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  font-size: 16px;
}

button {
  cursor: pointer;
}

input[type="range"] {
  width: 100%;
  margin-bottom: 10px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

th, td {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}

th {
  background: #eee;
}

.ticket {
  margin-top: 25px;
  border: 2px solid #000;
  padding: 15px;
}

.ticket h2 {
  text-align: center;
  margin-bottom: 10px;
}

.ticket-info {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  font-weight: bold;
  gap: 10px;
}

.summary {
  font-size: 18px;
  font-weight: bold;
  margin-top: 10px;
  text-align: center;
}

.status {
  margin-top: 8px;
  text-align: center;
  font-weight: bold;
}

/* Length options */
#lengthOptions {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-bottom: 10px;
}

#lengthOptions label {
  background: #f3f3f3;
  padding: 6px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
}

#lengthOptions input {
  transform: scale(1.2);
}

.length-buttons {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

@media print {
  input, select, button, h3, .length-buttons {
    display: none;
  }
  body {
    margin: 0;
  }
  .ticket {
    border: none;
  }
}
</style>
</head>

<body>

<!-- LOGO HEADER -->
<div class="header">
  <img src="builders-firstsource.png" alt="Builders FirstSource Logo">
</div>

<h2>Exact Lumber Generator</h2>

<label>Customer / Job</label>
<input type="text" id="job" placeholder="Customer or Job Name">

<label>Lumber Type</label>
<select id="type">
  <option value="2x4">2x4 (13 sticks per row)</option>
  <option value="2x6">2x6 (8 sticks per row)</option>
</select>

<label>Total Feet Needed</label>
<input type="number" id="target" placeholder="Example: 2456">

<h3>Allowed Lengths</h3>
<div id="lengthOptions">
  <label><input type="checkbox" value="8"> 8 ft</label>
  <label><input type="checkbox" value="10"> 10 ft</label>
  <label><input type="checkbox" value="12"> 12 ft</label>
  <label><input type="checkbox" value="14"> 14 ft</label>
  <label><input type="checkbox" value="16" checked> 16 ft</label>
  <label><input type="checkbox" value="18"> 18 ft</label>
  <label><input type="checkbox" value="20" checked> 20 ft</label>
</div>

<div class="length-buttons">
  <button onclick="selectAllLengths()">Select All</button>
  <button onclick="clearLengths()">Clear</button>
</div>

<h3>Favor Longer Lengths: <span id="favorValue">5</span></h3>
<input type="range" id="favorSlider" min="1" max="10" value="5">

<h3>Yard Presets</h3>
<div class="length-buttons">
  <button onclick="applyPreset('clean')">Clean Pull</button>
  <button onclick="applyPreset('long')">Long Heavy</button>
  <button onclick="applyPreset('minimal')">Minimal Loose</button>
</div>

<button onclick="generate()">Generate Order</button>
<button onclick="window.print()">Print Yard Ticket</button>

<div id="ticket" class="ticket" style="display:none;">
  <h2>YARD PICK TICKET</h2>

  <div class="ticket-info">
    <div id="ticketJob"></div>
    <div id="ticketType"></div>
    <div id="ticketFeet"></div>
    <div id="ticketMeta"></div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Length</th>
        <th>Sticks</th>
        <th>Rows / Loose</th>
        <th>Total Feet</th>
      </tr>
    </thead>
    <tbody id="results"></tbody>
  </table>

  <div class="summary" id="summary"></div>
  <div class="status" id="status"></div>
</div>

<script>
const slider = document.getElementById("favorSlider");
const sliderValue = document.getElementById("favorValue");
slider.addEventListener("input", () => sliderValue.textContent = slider.value);

function selectAllLengths() {
  document.querySelectorAll('#lengthOptions input').forEach(cb => cb.checked = true);
}

function clearLengths() {
  document.querySelectorAll('#lengthOptions input').forEach(cb => cb.checked = false);
}

function setLengths(values) {
  document.querySelectorAll('#lengthOptions input').forEach(cb => {
    cb.checked = values.includes(parseInt(cb.value));
  });
}

function applyPreset(preset) {
  clearLengths();

  if (preset === "clean") {
    setLengths([16, 20]);
    slider.value = 6;
  }

  if (preset === "long") {
    setLengths([14, 16, 18, 20]);
    slider.value = 9;
  }

  if (preset === "minimal") {
    setLengths([12, 14, 16, 20]);
    slider.value = 7;
  }

  sliderValue.textContent = slider.value;

  if (document.getElementById("target").value) {
    generate();
  }
}

function getEnabledLengths() {
  return Array.from(document.querySelectorAll('#lengthOptions input:checked'))
    .map(cb => parseInt(cb.value))
    .sort((a, b) => b - a);
}

function pickLengthWeighted(lengths, bias) {
  const maxLen = Math.max(...lengths);
  const weighted = [];
  lengths.forEach(len => {
    const weight = Math.max(1, Math.round((len / maxLen) * bias * 2));
    for (let i = 0; i < weight; i++) weighted.push(len);
  });
  return weighted[Math.floor(Math.random() * weighted.length)];
}

function generate() {
  const target = Number(document.getElementById("target").value);
  const job = document.getElementById("job").value || "—";
  const type = document.getElementById("type").value;

  if (!target || target <= 0) {
    alert("Enter a valid target footage.");
    return;
  }

  const lengths = getEnabledLengths();
  if (lengths.length === 0) {
    alert("Select at least one allowed length.");
    return;
  }

  const bias = parseInt(slider.value);
  const rowSize = type === "2x4" ? 13 : 8;

  let rows = {};
  let loose = {};
  let total = 0;

  for (let i = 0; i < 500; i++) {
    const len = pickLengthWeighted(lengths, bias);
    const rowFeet = len * rowSize;
    if (total + rowFeet <= target) {
      rows[len] = (rows[len] || 0) + 1;
      total += rowFeet;
    }
  }

  let remainder = target - total;
  for (let len of lengths) {
    while (remainder >= len) {
      loose[len] = (loose[len] || 0) + 1;
      remainder -= len;
    }
  }

  const tbody = document.getElementById("results");
  tbody.innerHTML = "";

  let finalTotal = 0;
  let totalRows = 0;
  let totalLoose = 0;

  Object.keys(rows).sort((a,b)=>b-a).forEach(len => {
    const r = rows[len];
    const sticks = r * rowSize;
    const feet = sticks * len;
    totalRows += r;
    finalTotal += feet;
    tbody.innerHTML += `<tr><td>${len}'</td><td>${sticks}</td><td>${r} rows</td><td>${feet}</td></tr>`;
  });

  Object.keys(loose).sort((a,b)=>b-a).forEach(len => {
    const sticks = loose[len];
    const feet = sticks * len;
    totalLoose += sticks;
    finalTotal += feet;
    tbody.innerHTML += `<tr><td>${len}'</td><td>${sticks}</td><td>Loose</td><td>${feet}</td></tr>`;
  });

  const diff = finalTotal - target;

  document.getElementById("ticketJob").innerText = `Job: ${job}`;
  document.getElementById("ticketType").innerText = `Material: ${type}`;
  document.getElementById("ticketFeet").innerText = `Total: ${finalTotal} ft`;
  document.getElementById("ticketMeta").innerText =
    `Ticket #${Date.now().toString().slice(-6)} • ${new Date().toLocaleString()}`;

  document.getElementById("summary").innerText =
    `Forklift Pull: ${totalRows} full rows + ${totalLoose} loose sticks`;

  document.getElementById("status").innerText =
    diff === 0 ? "✅ Exact Match" :
    diff > 0 ? `⚠ Over by ${diff} ft` :
               `⚠ Under by ${Math.abs(diff)} ft`;

  document.getElementById("ticket").style.display = "block";
}
</script>

</body>
</html>
